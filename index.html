
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CREOVIA - Digital Marketplace</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- PayPal JavaScript SDK (Sandbox ŸÑŸÑÿ™ÿ¨ÿ±ÿ®ÿ© - ÿ∫ŸäŸëÿ± ÿ•ŸÑŸâ Live ŸÑÿßÿ≠ŸÇÿßŸã) -->
    <script src="https://www.paypal.com/sdk/js?client-id=Ady-fs_MNNG5Ue22tNNapD9abvFULboMBDy5vAbpDYt8jCVNkqeyS1hssK58OTIWLWQt5xHxZlcZ_hSB&currency=USD&intent=capture"></script>



    <!-- Firebase SDK (modular) -->
    <script type="module">
          window.currentUser = null;
        // Firebase Configuration (ŸÖŸÜ ŸÖÿ¥ÿ±ŸàÿπŸÉ)
        const firebaseConfig = {
            apiKey: "AIzaSyCh2Pf1c1Gb7fQCQy64WmNYvWBKffwiuOs",
            authDomain: "creoveo-7da32.firebaseapp.com",
            projectId: "creoveo-7da32",
            storageBucket: "creoveo-7da32.firebasestorage.app",
            messagingSenderId: "819015345734",
            appId: "1:819015345734:web:b12e15fcaa6c3234b7cc47",
            measurementId: "G-58G17GT7VF"
        };
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import {
            getAuth,
            onAuthStateChanged,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
      
        import {
  getFirestore,
  doc,
  setDoc,
  collection,
  getDocs
} from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

const db = getFirestore(app);

        
        // ŸÖÿ±ÿßŸÇÿ®ÿ© ÿ≠ÿßŸÑÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
        onAuthStateChanged(auth, (user) => {
    window.currentUser = user; // ‚úÖ ŸÜÿ≠ŸÅÿ∏ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿπÿßŸÑŸÖŸäŸãÿß

    const userEmailElement = document.getElementById("user-email");
    const logoutBtn = document.getElementById("logout-btn");
    const loginLink = document.getElementById("login-link");

    if (user) {
        userEmailElement.textContent = user.email;
        userEmailElement.style.display = "inline";
        logoutBtn.style.display = "inline-block";
        loginLink.style.display = "none";
    } else {
        userEmailElement.style.display = "none";
        logoutBtn.style.display = "none";
        loginLink.style.display = "inline";
    }
});

        // ÿØÿßŸÑÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ (ÿ™ŸÖ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿπŸÖŸÑŸáÿß)
        window.handleLogout = function() {
            signOut(auth)
                .then(() => {
                    console.log("User signed out successfully");
                    window.location.href = "login.html";
                })
                .catch((error) => {
                    console.error("Logout error:", error);
                    alert("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨: " + error.message);
                });
        };
    </script>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        body {
            background: #f9fafb;
            color: #111827;
            line-height: 1.6;
        }
        header {
            background: #6d28d9;
            color: white;
            padding: 1.1rem 5%;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        h1 {
            font-size: 1.95rem;
            font-weight: 700;
        }
        nav {
            display: flex;
            align-items: center;
            gap: 1.8rem;
            flex-wrap: wrap;
        }
        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.25s;
        }
        nav a:hover {
            color: #ddd6fe;
        }
        #user-email {
            color: #e0e7ff;
            font-weight: 500;
            font-size: 0.95rem;
            background: rgba(255,255,255,0.15);
            padding: 0.4rem 0.9rem;
            border-radius: 8px;
            display: none;
        }
        #logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
            display: none;
        }
        #logout-btn:hover {
            background: rgba(255,255,255,0.35);
        }
        #login-link {
            color: white;
            text-decoration: none;
            font-weight: 500;
        }
        .hero {
            background: linear-gradient(135deg, #6d28d9 0%, #8b5cf6 100%);
            color: white;
            text-align: center;
            padding: 7.5rem 5% 6rem;
        }
        .hero h2 {
            font-size: 2.9rem;
            margin-bottom: 1.1rem;
            font-weight: 700;
        }
        .hero p {
            font-size: 1.3rem;
            max-width: 720px;
            margin: 0 auto;
            opacity: 0.92;
        }
        main {
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 5%;
        }
        .search-and-filters {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 1.2rem 2rem;
            margin: 2.5rem 0 3.5rem;
        }
        .search-container {
            position: relative;
            width: 100%;
            max-width: 380px;
        }
        #searchInput {
            width: 100%;
            padding: 0.9rem 1rem 0.9rem 3rem;
            border: 1px solid #d1d5db;
            border-radius: 999px;
            font-size: 1rem;
            background: white;
        }
        .search-icon {
            position: absolute;
            left: 1.1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 1.3rem;
        }
        .filters {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.6rem;
        }
        .filter-btn {
            background: #e5e7eb;
            border: none;
            padding: 0.75rem 1.5rem;
            margin: 0.2rem;
            border-radius: 999px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.25s;
        }
        .filter-btn.active,
        .filter-btn:hover {
            background: #6d28d9;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(109,40,217,0.25);
        }
        .products {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(285px, 1fr));
            gap: 2rem;
            margin-bottom: 5rem;
        }
        .product-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 16px 40px rgba(109,40,217,0.2);
        }
        .product-card img {
            width: 100%;
            height: 225px;
            object-fit: contain;
            background: #f3f4f6;
            padding: 1.6rem;
        }
        .product-info {
            padding: 1.4rem 1.5rem 1.8rem;
            text-align: center;
        }
        .product-info h3 {
            font-size: 1.28rem;
            margin-bottom: 0.6rem;
            font-weight: 600;
        }
        .type-badge {
            display: inline-block;
            background: #ede9fe;
            color: #6d28d9;
            padding: 0.35rem 0.9rem;
            border-radius: 999px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 0.4rem;
        }
        .sales-count {
            font-size: 0.95rem;
            color: #7c3aed;
            font-weight: 600;
            margin-bottom: 0.6rem;
            background: rgba(124, 58, 237, 0.1);
            padding: 0.35rem 0.9rem;
            border-radius: 999px;
            display: inline-block;
        }
        .price {
            font-size: 1.45rem;
            font-weight: 700;
            color: #059669;
            margin: 0.6rem 0 1rem;
        }
        .buy-btn-container {
            width: 100%;
            min-height: 50px;
        }
        .upload-section {
            background: white;
            border-radius: 20px;
            padding: 3.2rem;
            box-shadow: 0 10px 35px rgba(0,0,0,0.08);
            margin: 5rem auto;
            max-width: 820px;
        }
        .upload-section h2 {
            text-align: center;
            color: #111827;
            margin-bottom: 1.8rem;
            font-size: 2.1rem;
        }
        .form-group {
            margin-bottom: 2rem;
        }
        label {
            display: block;
            margin-bottom: 0.7rem;
            font-weight: 600;
            color: #374151;
        }
        .upload-area {
            border: 2px dashed #9ca3af;
            border-radius: 12px;
            padding: 2.5rem 1.5rem;
            text-align: center;
            background: #f9fafb;
            transition: all 0.25s ease;
            cursor: pointer;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .upload-area:hover,
        .upload-area.dragover {
            border-color: #6d28d9;
            background: #f3e8ff;
            box-shadow: 0 0 0 3px rgba(109,40,217,0.12);
        }
        .upload-area .icon {
            font-size: 3.2rem;
            margin-bottom: 1rem;
            color: #9ca3af;
        }
        .upload-area p {
            margin: 0.4rem 0;
            color: #4b5563;
        }
        .upload-area .hint {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }
        .file-name {
            margin-top: 1rem;
            color: #059669;
            font-weight: 500;
            font-size: 0.95rem;
            word-break: break-all;
        }
        input[type="file"] {
            display: none;
        }
        input[type="text"],
        textarea,
        select,
        input[type="number"] {
            width: 100%;
            padding: 0.95rem 1.3rem;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            font-size: 1rem;
        }
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        .submit-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 1.1rem 2.8rem;
            border-radius: 999px;
            font-size: 1.12rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 2rem;
            transition: background 0.3s;
        }
        .submit-btn:hover:not(:disabled) {
            background: #059669;
        }
        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        footer {
            background: #111827;
            color: #d1d5db;
            text-align: center;
            padding: 3rem 1rem;
            margin-top: 6rem;
        }
        @media (max-width: 768px) {
            .hero h2 { font-size: 2.3rem; }
            .hero p { font-size: 1.15rem; }
            nav { flex-wrap: wrap; gap: 1rem; justify-content: center; }
            .search-and-filters { flex-direction: column; gap: 1.5rem; }
        }

.seller-name {
    font-size: 0.9rem;
    color: #6b7280;
    margin-top: 0.5rem;
}

        .share-btn {
    width: 100%;
    margin-top: 0.6rem;
    padding: 0.6rem 1rem;
    border: none;
    border-radius: 8px;
    background: #6366f1;
    color: white;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
}

.share-btn:hover {
    background: #4f46e5;
}

        
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>CREOVIA</h1>
            <nav>
                <a href="index.html">Home</a>
                <a href="categories.html">Categories</a>
                <a href="#upload-section">Upload</a>
                <a href="#" onclick="goToDashboard()">Dashboard</a>

                <a href="contact.html">Contact</a>
                <span id="user-email"></span>
                <button id="logout-btn" onclick="handleLogout()">Logout</button>
                <a href="login.html" id="login-link">Login</a>
            </nav>
        </div>
    </header>
    <section class="hero">
        <h2>Sell & Buy Digital Products Easily</h2>
        <p>Ebooks, templates, logos, digital magazines, design assets and more ‚Äî all in one beautiful marketplace.</p>
    </section>
    <main>
        <div class="search-and-filters">
            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input type="text" id="searchInput" placeholder="Search products by name...">
            </div>
            <div class="filters">
                <button class="filter-btn active" onclick="filterProducts('all')">All</button>
                <button class="filter-btn" onclick="filterProducts('ebook')">Ebooks</button>
                <button class="filter-btn" onclick="filterProducts('template')">Templates</button>
                <button class="filter-btn" onclick="filterProducts('magazine')">Magazines</button>
                <button class="filter-btn" onclick="filterProducts('logo')">Logos</button>
            </div>
        </div>
        <section class="products" id="productsContainer">
            <!-- Products will be loaded here -->
        </section>
        <section class="upload-section" id="upload-section">
            <h2>Upload Your Digital Product</h2>
         
            <form id="uploadForm">
                <div class="form-group">
                    <label>Product Preview Image</label>
                    <div class="upload-area" id="previewArea">
                        <div class="icon">üñºÔ∏è</div>
                        <p><strong>Click to select</strong> or drag & drop image here</p>
                        <p class="hint">PNG, JPG, recommended size 1200√ó800 or larger</p>
                        <div class="file-name" id="previewFileName"></div>
                        <input type="file" id="previewImage" name="preview" accept="image/*" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Main Product File</label>
                    <div class="upload-area" id="fileArea">
                        <div class="icon">üì¶</div>
                        <p><strong>Click to select</strong> or drag & drop your file here</p>
                        <p class="hint">PDF, ZIP, PSD, AI, FIG, EPUB, etc.</p>
                        <div class="file-name" id="mainFileName"></div>
                        <input type="file" id="fileInput" name="file" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Product Name</label>
                    <input type="text" id="productName" placeholder="e.g. Minimalist Logo Pack" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="productDesc" placeholder="Describe your product..." required></textarea>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="productType" required>
                        <option value="">Select category</option>
                        <option value="ebook">Ebook</option>
                        <option value="template">Template</option>
                        <option value="magazine">Magazine</option>
                        <option value="logo">Logo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Price (USD)</label>
                    <input type="number" id="productPrice" placeholder="19.99" min="0.99" step="0.01" required>
                </div>
                <button type="submit" class="submit-btn">Upload Product</button>
            </form>
        </section>
    </main>
    <footer>
        <p>¬© 2026 CREOVIA ‚Äî All Rights Reserved</p>
    </footer>
    <script>
        function setupUploadArea(areaId, inputId, nameDisplayId) {
            const area = document.getElementById(areaId);
            const input = document.getElementById(inputId);
            const nameDisplay = document.getElementById(nameDisplayId);
            area.addEventListener('click', () => input.click());
            input.addEventListener('change', updateFileName);
            ['dragenter', 'dragover'].forEach(eventName => {
                area.addEventListener(eventName, e => {
                    e.preventDefault();
                    area.classList.add('dragover');
                });
            });
            ['dragleave', 'drop'].forEach(eventName => {
                area.addEventListener(eventName, e => {
                    e.preventDefault();
                    area.classList.remove('dragover');
                });
            });
            area.addEventListener('drop', e => {
                if (e.dataTransfer.files.length > 0) {
                    input.files = e.dataTransfer.files;
                    updateFileName();
                }
            });
            function updateFileName() {
                if (input.files.length > 0) {
                    nameDisplay.textContent = input.files[0].name;
                } else {
                    nameDisplay.textContent = '';
                }
            }
        }
        setupUploadArea('previewArea', 'previewImage', 'previewFileName');
        setupUploadArea('fileArea', 'fileInput', 'mainFileName');
        let allProducts = [];
        let currentFilter = 'all';
        async function loadProducts() {
            try {
                const res = await fetch('https://backend-creovea.onrender.com/products');
                if (!res.ok) throw new Error('Failed to fetch products');
                allProducts = await res.json();
                updateProductsDisplay();
            } catch (err) {
                console.error('Error:', err);
                document.getElementById('productsContainer').innerHTML =
                    '<p style="text-align:center; color:#ef4444; grid-column:1/-1; font-size:1.2rem;">Unable to load products at the moment...</p>';
            }
        }
        function renderProducts(products) {
            console.log('renderProducts called with:', products.length);

            const container = document.getElementById('productsContainer');
            container.innerHTML = '';
            if (products.length === 0) {
                container.innerHTML = '<p style="text-align:center; grid-column:1/-1; color:#6b7280; font-size:1.25rem;">No products found</p>';
                return;
            }
            products.forEach(p => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.style.cursor = 'pointer';
card.addEventListener('click', () => {
    window.location.href = `product.html?id=${p.id}`;
});

                const productId = p.id;
                const price = Number(p.price).toFixed(2);
                const name = p.name;
                const salesCount = p.salesCount || 0;

                const sellerName = p.sellerEmail || 'Unknown';


card.innerHTML = `
    <img src="${p.previewImage || 'https://via.placeholder.com/300x225?text=Preview'}" alt="${name}">
    <div class="product-info">
        <h3>${name}</h3>
        <span class="type-badge">${p.type || 'Unknown'}</span>
        <div class="sales-count">Sales: ${salesCount}</div>
        <div class="price">$${price}</div>
        <div class="seller-name" style="margin-top:0.5rem; font-size:0.9rem; color:#6b7280;">By: ${sellerName}</div>

<div class="rating-box" style="margin-top:0.8rem;">
  <textarea 
    placeholder="Leave a comment (optional)"
    class="rating-comment"
    style="width:100%; padding:0.4rem; font-size:0.85rem;"
  ></textarea>

  <div style="margin-top:0.4rem;">
    <button class="like-btn">üëç</button>
    <button class="dislike-btn">üëé</button>
  </div>


        
        <div class="buy-btn-container" id="paypal-button-${productId}"></div>

<!-- ÿ≤ÿ± ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑ -->
        <button class="share-btn" data-id="${productId}">
            üîó Copy Product Link
        </button>

        <div class="buy-btn-container" id="paypal-button-${productId}"></div>
   
    </div>
`;

                container.appendChild(card);

const likeBtn = card.querySelector('.like-btn');
const dislikeBtn = card.querySelector('.dislike-btn');
const commentInput = card.querySelector('.rating-comment');

async function submitRating(isLike) {
  if (!window.currentUser) {
    alert('You must be logged in to rate.');
    return;
  }

  try {
    const ratingRef = doc(
      db,
      'products',
      productId,
      'ratings',
      window.currentUser.uid
    );

    await setDoc(ratingRef, {
      userId: window.currentUser.uid,
      like: isLike,
      comment: commentInput.value || '',
      createdAt: Date.now()
    });

    alert('‚úÖ Rating submitted');
    likeBtn.disabled = true;
    dislikeBtn.disabled = true;

  } catch (err) {
    alert('‚ùå You already rated this product');
    console.error(err);
  }
}

likeBtn.addEventListener('click', e => {
  e.stopPropagation();
  submitRating(true);
});

dislikeBtn.addEventListener('click', e => {
  e.stopPropagation();
  submitRating(false);
});

                
const shareBtn = card.querySelector('.share-btn');

shareBtn.addEventListener('click', (e) => {
    e.stopPropagation(); // ŸäŸÖŸÜÿπ ŸÅÿ™ÿ≠ ÿµŸÅÿ≠ÿ© ÿßŸÑŸÖŸÜÿ™ÿ¨

    const productId = shareBtn.dataset.id;
    const productUrl = `${window.location.origin}${window.location.pathname.replace(/\/[^/]*$/, '')}/product.html?id=${productId}`;


    navigator.clipboard.writeText(productUrl)
        .then(() => {
            alert('‚úÖ Product link copied!');
        })
        .catch(() => {
            alert('‚ùå Failed to copy link');
        });
});

                // ÿ•ŸÜÿ¥ÿßÿ° ÿ≤ÿ± PayPal ÿØŸäŸÜÿßŸÖŸäŸÉŸä ŸÑŸÉŸÑ ŸÖŸÜÿ™ÿ¨
             
              paypal.Buttons({
    createOrder: function(data, actions) {
        return actions.order.create({
            purchase_units: [{
                amount: { value: price },
            }]
        });
    },
    onApprove: function(data, actions) {
        // ‚úÖ ŸáŸÜÿß ÿ™ÿ£ŸÉÿØ ÿ£ŸÜ productId ÿµÿ≠Ÿäÿ≠
        console.log('Sending payment for productId:', productId); // Ÿáÿ∞ÿß ÿ≥Ÿäÿ≥ÿßÿπÿØŸÉ ÿπŸÑŸâ ÿ™ÿ™ÿ®ÿπ

        return fetch('https://backend-creovea.onrender.com/record-payment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                productId: productId, // Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ŸÜŸÅÿ≥ ÿßŸÑŸÄ ID ÿßŸÑŸÖŸàÿ¨ŸàÿØ ŸÅŸä Firestore
                orderId: data.orderID
            })
        })
        .then(res => res.json())
        .then(result => {
            if (!result.success) alert('Payment verification failed');
           else {
    alert('‚úÖ Payment successful!');
    loadProducts(); // üî• Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ∑ÿ± ÿßŸÑŸÖŸáŸÖ
    window.location.href = result.downloadUrl;
}

        });
    },
    onError: function(err) {
        console.error('PayPal error:', err);
        alert('Payment failed. Please try again.');
    }
}).render(`#paypal-button-${productId}`);




               
    }); // ÿ•ÿ∫ŸÑÿßŸÇ forEach
} // ÿ•ÿ∫ŸÑÿßŸÇ renderProducts

        function updateProductsDisplay() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
          
            let filteredProducts = allProducts;
            if (currentFilter !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.type === currentFilter);
            }
            if (searchTerm !== '') {
                filteredProducts = filteredProducts.filter(p =>
                    p.name.toLowerCase().includes(searchTerm)
                );
            }
            renderProducts(filteredProducts);
        }
       function filterProducts(type) {
    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));

    // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≤ÿ± ÿßŸÑÿµÿ≠Ÿäÿ≠ ÿ®ÿØŸàŸÜ event
    document.querySelectorAll('.filter-btn').forEach(btn => {
        if (btn.textContent.toLowerCase().includes(type) || type === 'all') {
            btn.classList.add('active');
        }
    });

    currentFilter = type;
    updateProductsDisplay();
}

        document.getElementById('searchInput').addEventListener('input', updateProductsDisplay);
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const submitBtn = document.querySelector('.submit-btn');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = "Uploading...";
            submitBtn.style.opacity = "0.7";
            submitBtn.style.cursor = "not-allowed";
            const formData = new FormData();
         
            formData.append('preview', document.getElementById('previewImage').files[0]);
            formData.append('file', document.getElementById('fileInput').files[0]);
            formData.append('name', document.getElementById('productName').value.trim());
            formData.append('desc', document.getElementById('productDesc').value.trim());
            formData.append('type', document.getElementById('productType').value);
            formData.append('price', document.getElementById('productPrice').value);
           if (!window.currentUser) {
    alert('You must be logged in to upload a product.');
    submitBtn.disabled = false;
    submitBtn.textContent = originalText;
    submitBtn.style.opacity = "1";
    submitBtn.style.cursor = "pointer";
    return;
}

formData.append('sellerEmail', window.currentUser.email);


            try {
                const response = await fetch('https://backend-creovea.onrender.com/upload', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                if (response.ok) {
                    alert('Product uploaded successfully!');
                    document.getElementById('uploadForm').reset();
                    document.getElementById('previewFileName').textContent = '';
                    document.getElementById('mainFileName').textContent = '';
                    loadProducts();
                } else {
                    alert('Upload failed: ' + (result.message || 'Unknown error'));
                }
            } catch (error) {
                alert('Could not connect to server\n' + error.message);
                console.error(error);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                submitBtn.style.opacity = "1";
                submitBtn.style.cursor = "pointer";
            }
        });
        loadProducts();
   </script>
   
    <script>
function goToDashboard() {
    if (!window.currentUser) {
        window.location.href = "login.html";
    } else {
        window.location.href = "dashboard.html";
    }
}

    
    </script>
</body>
</html>





















